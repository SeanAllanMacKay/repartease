name: Deploy to DigitalOcean Droplet
'on':
  push:
    branches:
      - master

jobs:
  build-and-deploy:
    name: Build and Deploy
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Build Apps
        run: |
          npm install
          npm run build
      - name: Configure SSH
        env:
          KEY: ${{ secrets.KEY }}
        run: |
          mkdir -p ~/.ssh
          echo "${KEY}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
      - name: Deploy to DigitalOcean Droplet
        env:
          USERNAME: ${{ secrets.USERNAME }}
          HOST: ${{ secrets.HOST }}
        run: |
          scp -r $USERNAME@$HOST:/repartease/frontend ./apps/frontend/dist
          scp -r $USERNAME@$HOST:/repartease/reverse-proxy ./apps/reverse-proxy/dist
          scp -r $USERNAME@$HOST:/repartease/server ./apps/server/dist
